<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Choice Is Yours ‚ú®</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#fef6ee;
      --bg2:#fde8d8;
      --card: rgba(255,255,255,.72);
      --stroke: rgba(180,120,80,.18);
      --text: #2c1a0e;
      --muted: #7a5540;
      --hot:#e8613a;
      --hot2:#f5a07a;
      --ok:#4caf6a;
      --shadow: 0 30px 80px rgba(120,60,20,.13);
      --r: 24px;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent;}
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      min-height:100vh;
      min-height:100dvh;
      display:grid;
      place-items:start center;
      font-family: 'DM Sans', sans-serif;
      background:
        radial-gradient(900px 600px at 10% 15%, rgba(232,97,58,.13), transparent 60%),
        radial-gradient(700px 500px at 88% 80%, rgba(245,160,122,.18), transparent 55%),
        radial-gradient(600px 500px at 55% 50%, rgba(255,220,190,.25), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      color: var(--text);
      overflow-x:hidden;
      overflow-y:auto;
      padding: 20px 0 50px;
    }

    /* Grain overlay */
    body::before{
      content:'';
      position:fixed; inset:0;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='.4'/%3E%3C/svg%3E");
      opacity:.045;
      pointer-events:none;
      mix-blend-mode:multiply;
    }

    .wrap{
      width:min(900px, calc(100vw - 24px));
      display:grid;
      gap:14px;
      grid-template-columns: 1.15fr .85fr;
      align-items:start;
      position:relative;
      z-index:2;
      margin:auto;
    }
    @media (max-width: 680px){
      .wrap{ grid-template-columns:1fr; gap:12px; }
      body{ padding: 14px 0 60px; }
    }
    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      padding: 22px 20px;
      position:relative;
      overflow:hidden;
    }
    @media (max-width: 680px){
      .card{ padding: 18px 16px; border-radius: 18px; }
    }
    .card::before{
      content:'';
      position:absolute;
      inset:0;
      border-radius: var(--r);
      background: linear-gradient(135deg, rgba(255,255,255,.4) 0%, transparent 50%);
      pointer-events:none;
    }

    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:6px 11px;
      border:1px solid rgba(232,97,58,.25);
      border-radius:999px;
      background: rgba(232,97,58,.08);
      color:var(--hot);
      font-weight:700;
      font-size:11px;
      letter-spacing:.10em;
      text-transform:uppercase;
    }
    .pulse{
      width:7px; height:7px; border-radius:50%;
      background: var(--hot);
      box-shadow: 0 0 0 0 rgba(232,97,58,.6);
      animation: ping 1.6s infinite;
      flex-shrink:0;
    }
    @keyframes ping{
      0%{ box-shadow: 0 0 0 0 rgba(232,97,58,.55); }
      70%{ box-shadow: 0 0 0 11px rgba(232,97,58,0); }
      100%{ box-shadow: 0 0 0 0 rgba(232,97,58,0); }
    }

    h1{
      margin:12px 0 8px;
      font-family: 'Playfair Display', serif;
      font-size: clamp(24px, 6vw, 42px);
      letter-spacing:-0.01em;
      line-height:1.1;
      color:#2c1a0e;
    }
    .sub{
      margin:0 0 16px;
      color:var(--muted);
      font-size: clamp(14px, 3.5vw, 15px);
      line-height:1.6;
    }
    .type{ font-style:italic; color: var(--hot); }
    .caret{
      display:inline-block;
      width:10px;
      animation: blink 1s steps(1) infinite;
      color: var(--hot2);
      font-style:normal;
    }
    @keyframes blink{ 50%{opacity:0} }

    .btnRow{
      display:flex;
      gap:10px;
      flex-direction:column;
      align-items:stretch;
      margin-top: 16px;
    }
    @media (min-width: 400px){
      .btnRow{ flex-direction:row; align-items:center; flex-wrap:wrap; }
    }
    button{
      border:0;
      border-radius: 14px;
      padding: 15px 20px;
      font-family: 'DM Sans', sans-serif;
      font-weight: 800;
      font-size: 15px;
      cursor:pointer;
      transition: transform .08s ease, filter .15s ease, box-shadow .15s ease;
      user-select:none;
      touch-action:manipulation;
      min-height:50px;
    }
    button:active{ transform: translateY(1px) scale(.99); }
    .yes{
      background: linear-gradient(135deg, var(--hot), #f08060);
      color:white;
      box-shadow: 0 10px 34px rgba(232,97,58,.28);
      flex:1;
    }
    .yes:hover{ filter: brightness(1.05); box-shadow: 0 14px 44px rgba(232,97,58,.38); }
    .later{
      background: rgba(44,26,14,.07);
      border:1px solid rgba(44,26,14,.14);
      color: var(--muted);
      flex:1;
    }
    .later:hover{ filter: brightness(.95); }

    .sideTitle{
      font-size: 11px;
      letter-spacing:.13em;
      text-transform:uppercase;
      color: var(--muted);
      font-weight:800;
      margin: 2px 0 12px;
    }
    .panel{ display:grid; gap:10px; }
    .mini{
      background: rgba(255,255,255,.5);
      border:1px solid rgba(180,120,80,.14);
      border-radius: 16px;
      padding: 13px;
      font-size:14px;
    }
    .mini b{ color: #2c1a0e; }
    .pillRow{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .pill{
      border-radius:999px;
      padding:10px 14px;
      background: rgba(255,255,255,.7);
      border:1px solid rgba(180,120,80,.18);
      color: var(--muted);
      font-family: 'DM Sans', sans-serif;
      font-weight:700;
      font-size: 13px;
      cursor:pointer;
      user-select:none;
      touch-action:manipulation;
      transition: transform .08s ease, background .15s ease, border-color .15s ease, color .15s ease;
      min-height:40px;
      display:flex; align-items:center;
    }
    .pill:active{ transform: scale(.97); }
    .pill.active{
      background: rgba(232,97,58,.12);
      border-color: rgba(232,97,58,.35);
      color: var(--hot);
    }

    .receipt{
      margin-top:14px;
      padding:13px;
      border-radius:14px;
      background: rgba(232,97,58,.06);
      border:1px dashed rgba(232,97,58,.28);
      font-family: ui-monospace, 'Courier New', monospace;
      font-size:12px;
      color: var(--muted);
      display:none;
      white-space: pre-wrap;
      line-height:1.6;
      word-break:break-word;
    }

    /* Canvas layers */
    canvas#fx{ position:fixed; inset:0; pointer-events:none; z-index:1; }
    canvas#confetti{ position:fixed; inset:0; pointer-events:none; z-index:60; }

    /* Modal ‚Äî bottom sheet on mobile, centered on desktop */
    .modal{
      position:fixed; inset:0;
      background: rgba(44,26,14,.4);
      display:none;
      place-items:end center;
      z-index:70;
    }
    @media (min-width: 540px){
      .modal{ place-items:center; padding:18px; }
    }
    .modal .sheet{
      width:100%;
      max-width:540px;
      background: rgba(255,248,242,.97);
      border:1px solid rgba(180,120,80,.18);
      border-radius: 26px 26px 0 0;
      padding: 10px 20px 40px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      position:relative;
      animation: slideUp .32s cubic-bezier(.22,.68,0,1.2);
    }
    @media (min-width: 540px){
      .modal .sheet{
        border-radius: 26px;
        padding: 24px;
        animation: none;
        width: min(540px, calc(100vw - 28px));
      }
    }
    @keyframes slideUp{
      from{ transform:translateY(100%); opacity:0; }
      to{ transform:translateY(0); opacity:1; }
    }
    .drag-handle{
      width:40px; height:4px;
      background:rgba(180,120,80,.25);
      border-radius:99px;
      margin:10px auto 16px;
    }
    @media (min-width:540px){ .drag-handle{ display:none; } }
    .modal h2{
      font-family: 'Playfair Display', serif;
      margin: 8px 0 6px;
      font-size: clamp(22px, 5vw, 26px);
      color:#2c1a0e;
    }
    .modal p{ margin:0; color: var(--muted); line-height:1.6; font-size:15px; }
    .x{
      position:absolute; top:18px; right:16px;
      width:38px; height:38px; border-radius:10px;
      border:1px solid rgba(180,120,80,.2);
      background: rgba(180,120,80,.08);
      color:var(--muted);
      font-weight:900;
      cursor:pointer;
      font-size:14px;
      touch-action:manipulation;
      display:none;
    }
    @media (min-width:540px){ .x{ display:flex; align-items:center; justify-content:center; } }
    .rowBtns{
      margin-top:16px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .rowBtns button{ flex:1; min-width:120px; }
  </style>
</head>
<body>

  <canvas id="fx"></canvas>

  <!-- Welcome Gate -->
  <div id="gate" style="
    position:fixed; inset:0; z-index:200;
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    background: linear-gradient(160deg, #fef6ee, #fde8d8);
    gap: 20px;
  ">
    <div style="text-align:center;">
      <div style="font-family:'Playfair Display',serif; font-size:clamp(32px,7vw,62px); color:#2c1a0e; letter-spacing:-0.02em; line-height:1.1;">
        Welcome,<br><em style="color:#e8613a;">Khushi</em> ‚ú®
      </div>
      <p style="font-family:'DM Sans',sans-serif; color:#7a5540; font-size:16px; margin:12px 0 28px; line-height:1.6;">
        Something small is waiting for you inside üôÇ
      </p>
      <button id="enterBtn" style="
        border:0; border-radius:16px;
        padding:16px 40px;
        font-family:'DM Sans',sans-serif;
        font-weight:800; font-size:17px;
        cursor:pointer; color:white;
        background: linear-gradient(135deg, #e8613a, #f08060);
        box-shadow: 0 14px 40px rgba(232,97,58,.30);
        transition: transform .1s ease, filter .15s ease;
        letter-spacing:.01em;
      ">Enter ‚Üí</button>
    </div>
  </div>

  <div class="wrap" style="opacity:0; pointer-events:none; transition: opacity .6s ease;" id="mainWrap">
    <div class="card" id="mainCard">
      <div class="badge"><span class="pulse"></span> Your call</div>

      <h1>
        <span id="type" class="type"></span><span class="caret">‚ñç</span>
      </h1>

      <p class="sub" id="subtitle">
        No pressure. Just pick what feels easy. üôÇ
      </p>

      <div class="btnRow">
        <button class="yes" id="yesBtn">I'm in üòå</button>
        <button class="later" id="laterBtn">Later / not yet üôÇ</button>
      </div>

      <div class="receipt" id="receipt"></div>
    </div>

    <div class="card">
      <div class="sideTitle">Build your plan</div>
      <div class="panel">
        <div class="mini">
          <b>Pick the vibe</b>
          <div class="pillRow" id="vibes">
            <div class="pill active" data-v="Coffee & walk ‚òïÔ∏èüö∂‚Äç‚ôÄÔ∏è">Coffee & walk ‚òïÔ∏è</div>
            <div class="pill" data-v="Dinner somewhere nice üç∞">Dinner somewhere nice üç∞</div>
            <div class="pill" data-v="15-min call + laugh üòÇ">15-min call üòÇ</div>
            <div class="pill" data-v="Surprise me üöó">Surprise me üöó</div>
          </div>
        </div>

        <div class="mini">
          <b>Pick the timing</b>
          <div class="pillRow" id="times">
            <div class="pill active" data-t="March check-in üìÖ">March üìÖ</div>
            <div class="pill" data-t="May meetup ‚úàÔ∏è">May ‚úàÔ∏è</div>
          </div>
        </div>

        <div class="mini">
          <b>How should it feel?</b>
          <div class="pillRow" id="pace">
            <div class="pill active" data-p="Keep it chill üåø">Keep it chill üåø</div>
            <div class="pill" data-p="Intentional & steady üéØ">Intentional & steady üéØ</div>
          </div>
          <div style="margin-top:10px; color:var(--muted); font-size:13px; line-height:1.5;">
            Your comfort &gt; everything. You choose the pace.
          </div>
        </div>

        <div class="mini">
          <b>Bonus perk</b><br/>
          Either choice earns: <span style="color:var(--ok); font-weight:800;">stress-free good vibes</span> ‚ú®
        </div>

        <div class="mini" id="jokeMini">
          <b>üÉè Idiot joke of the day</b>
          <div id="jokeText" style="margin-top:10px; color:var(--muted); font-size:13px; line-height:1.55;">Loading...</div>
          <div style="margin-top:8px;">
            <span id="jokeNext" style="font-size:12px; color:var(--hot); font-weight:700; cursor:pointer; text-decoration:underline dotted;">another one ‚Üí</span>
          </div>
        </div>
      </div>
    </div>
  </div><!-- /mainWrap -->

  <canvas id="confetti"></canvas>

  <div class="modal" id="modal">
    <div class="sheet">
      <div class="drag-handle"></div>
      <button class="x" id="close">‚úï</button>
      <div class="badge" style="margin-bottom:10px;"><span class="pulse"></span> Confirmed</div>
      <h2 id="modalTitle">Locked in üòå</h2>
      <p id="letter"></p>
      <div class="rowBtns">
        <button class="yes" id="copyBtn">Copy summary</button>
        <button class="later" id="againBtn">Replay ‚ú®</button>
      </div>
    </div>
  </div>

  <script>
    // ---------- Welcome Gate ----------
    document.getElementById("enterBtn").addEventListener("click", () => {
      const gate = document.getElementById("gate");
      const main = document.getElementById("mainWrap");
      gate.style.transition = "opacity .5s ease";
      gate.style.opacity = "0";
      setTimeout(() => { gate.style.display = "none"; }, 500);
      main.style.opacity = "1";
      main.style.pointerEvents = "auto";
      spawnBurst(10);
    });

    // ---------- Typewriter ----------
    const lines = [
      "Quick question‚Ä¶ üôÇ",
      "Pick what feels easy ‚ú®",
      "No pressure. Your call üòå"
    ];
    const typeEl = document.getElementById("type");
    let li = 0, ci = 0, deleting = false;
    function typeLoop(){
      const current = lines[li];
      if(!deleting){
        typeEl.textContent = current.slice(0, ci++);
        if(ci > current.length + 18) deleting = true;
      }else{
        typeEl.textContent = current.slice(0, ci--);
        if(ci <= 0){ deleting=false; li=(li+1)%lines.length; ci=0; }
      }
      setTimeout(typeLoop, deleting ? 26 : 44);
    }
    typeLoop();

    // ---------- Pills ----------
    function setupPills(id){
      const box = document.getElementById(id);
      box.addEventListener("click", e=>{
        const pill = e.target.closest(".pill");
        if(!pill) return;
        [...box.querySelectorAll(".pill")].forEach(p=>p.classList.remove("active"));
        pill.classList.add("active");
      });
    }
    setupPills("vibes"); setupPills("times"); setupPills("pace");
    function getActive(id, attr){
      return document.getElementById(id).querySelector(".pill.active")?.getAttribute(attr)||"";
    }

    // ---------- Modal & buttons ----------
    const modal = document.getElementById("modal");
    const subtitle = document.getElementById("subtitle");
    const receipt = document.getElementById("receipt");
    const modalTitle = document.getElementById("modalTitle");
    const letter = document.getElementById("letter");

    document.getElementById("close").addEventListener("click",()=>modal.style.display="none");
    modal.addEventListener("click",e=>{ if(e.target===modal) modal.style.display="none"; });

    document.getElementById("againBtn").addEventListener("click",()=>{ blastConfetti(); spawnBurst(16); });

    function buildSummary(status){
      return `‚Äî PLAN SUMMARY ‚Äî
Status: ${status}
Vibe:   ${getActive("vibes","data-v")}
When:   ${getActive("times","data-t")}
Pace:   ${getActive("pace","data-p")}

Note:   Your comfort > everything. üôÇ`;
    }

    document.getElementById("yesBtn").addEventListener("click",()=>{
      subtitle.textContent = "Locked in. Simple. üòå";
      receipt.style.display = "block";
      receipt.textContent = buildSummary("I'm in ‚úÖ");
      blastConfetti();
      modalTitle.textContent = "Locked in üòå";
      letter.textContent = "Cool. No pressure energy. We'll keep it easy and make it fun.";
      modal.style.display = "grid";
    });

    document.getElementById("laterBtn").addEventListener("click",()=>{
      subtitle.textContent = "Respect. We'll keep it chill. üåø";
      receipt.style.display = "block";
      receipt.textContent = buildSummary("Later / not yet üôÇ");
      spawnBurst(10);
      modalTitle.textContent = "All good üôÇ";
      letter.textContent = "No rush at all. Pick a vibe/timing whenever you feel like it.";
      modal.style.display = "grid";
    });

    document.getElementById("copyBtn").addEventListener("click", async ()=>{
      try{
        await navigator.clipboard.writeText(receipt.textContent || buildSummary("‚Äî"));
        document.getElementById("copyBtn").textContent="Copied ‚úÖ";
        setTimeout(()=>document.getElementById("copyBtn").textContent="Copy summary",1100);
      }catch{
        document.getElementById("copyBtn").textContent="Copy failed";
        setTimeout(()=>document.getElementById("copyBtn").textContent="Copy summary",1100);
      }
    });

    // ====================================================
    //  POLLY & PAX ‚Äî artsy floating paper-cut characters
    // ====================================================
    const fx = document.getElementById("fx");
    const fctx = fx.getContext("2d");
    let W=0,H=0,DPR=1;

    function resizeFx(){
      DPR=devicePixelRatio||1;
      W=innerWidth; H=innerHeight;
      fx.width=Math.floor(W*DPR);
      fx.height=Math.floor(H*DPR);
      fctx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener("resize",resizeFx);
    resizeFx();

    // ---------- Draw Polly (round, dreamy, curly hair) ----------
    function drawPolly(ctx, x, y, scale, alpha){
      ctx.save();
      ctx.globalAlpha = alpha;
      ctx.translate(x, y);
      ctx.scale(scale, scale);

      // body ‚Äî warm terracotta dress
      ctx.beginPath();
      ctx.ellipse(0, 18, 11, 15, 0, 0, Math.PI*2);
      ctx.fillStyle = "#e8a07a";
      ctx.fill();

      // head
      ctx.beginPath();
      ctx.arc(0, -4, 10, 0, Math.PI*2);
      ctx.fillStyle = "#f5c9a0";
      ctx.fill();

      // curly hair ‚Äî 5 little circles as puffs
      const hairColor = "#5c2e0e";
      const puffs = [[-10,-10],[-7,-17],[0,-19],[7,-17],[10,-10]];
      puffs.forEach(([px,py])=>{
        ctx.beginPath();
        ctx.arc(px, py, 6.5, 0, Math.PI*2);
        ctx.fillStyle = hairColor;
        ctx.fill();
      });

      // eyes ‚Äî small dots
      ctx.fillStyle = "#2c1a0e";
      ctx.beginPath(); ctx.arc(-3.5,-4,1.2,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(3.5,-4,1.2,0,Math.PI*2); ctx.fill();

      // smile
      ctx.beginPath();
      ctx.arc(0, -2, 3.5, 0.2, Math.PI-0.2);
      ctx.strokeStyle = "#a05030";
      ctx.lineWidth=1.2;
      ctx.stroke();

      // little arms
      ctx.strokeStyle = "#e8a07a";
      ctx.lineWidth=2.5;
      ctx.lineCap="round";
      // left arm wave
      ctx.beginPath(); ctx.moveTo(-10,12); ctx.quadraticCurveTo(-18,5,-14,-2); ctx.stroke();
      // right arm
      ctx.beginPath(); ctx.moveTo(10,12); ctx.quadraticCurveTo(18,8,16,1); ctx.stroke();

      // legs
      ctx.strokeStyle="#c97050";
      ctx.lineWidth=3;
      ctx.beginPath(); ctx.moveTo(-4,30); ctx.lineTo(-5,42); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(4,30); ctx.lineTo(5,42); ctx.stroke();

      ctx.restore();
    }

    // ---------- Draw Pax (taller, angular, little bun) ----------
    function drawPax(ctx, x, y, scale, alpha){
      ctx.save();
      ctx.globalAlpha = alpha;
      ctx.translate(x, y);
      ctx.scale(scale, scale);

      // body ‚Äî olive/sage top
      ctx.beginPath();
      ctx.roundRect(-9, 5, 18, 22, 5);
      ctx.fillStyle = "#7aab82";
      ctx.fill();

      // pants
      ctx.fillStyle = "#4a6c52";
      ctx.beginPath(); ctx.roundRect(-9,22,8,14,3); ctx.fill();
      ctx.beginPath(); ctx.roundRect(1,22,8,14,3); ctx.fill();

      // head
      ctx.beginPath();
      ctx.arc(0, -5, 9.5, 0, Math.PI*2);
      ctx.fillStyle = "#c8956a";
      ctx.fill();

      // hair bun + top hair
      ctx.fillStyle = "#3a1e0a";
      ctx.beginPath(); ctx.arc(0,-13,5,0,Math.PI*2); ctx.fill(); // bun
      ctx.beginPath(); ctx.ellipse(0,-7,9,5,0,Math.PI,Math.PI*2); ctx.fill(); // top hair

      // eyes
      ctx.fillStyle="#1a0a04";
      ctx.beginPath(); ctx.arc(-3.2,-5,1.1,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(3.2,-5,1.1,0,Math.PI*2); ctx.fill();

      // slight smile
      ctx.beginPath();
      ctx.arc(0,-3,3,0.3,Math.PI-0.3);
      ctx.strokeStyle="#8a5030";
      ctx.lineWidth=1.1;
      ctx.stroke();

      // arms
      ctx.strokeStyle="#7aab82";
      ctx.lineWidth=2.8; ctx.lineCap="round";
      ctx.beginPath(); ctx.moveTo(-9,10); ctx.quadraticCurveTo(-17,6,-15,0); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(9,10); ctx.quadraticCurveTo(17,14,15,8); ctx.stroke();

      // shoes
      ctx.fillStyle="#2a1205";
      ctx.beginPath(); ctx.ellipse(-5,36,5,2.5,0.1,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.ellipse(5,36,5,2.5,-0.1,0,Math.PI*2); ctx.fill();

      ctx.restore();
    }

    // ---------- Character particles ----------
    let chars = [];
    const CHAR_COUNT = 18;

    function makeChar(){
      const isPolly = Math.random() > 0.5;
      return {
        type: isPolly ? "polly" : "pax",
        x: Math.random()*W,
        y: H + 80 + Math.random()*200,
        scale: 0.55 + Math.random()*0.65,
        vy: 0.5 + Math.random()*1.4,
        vx: -0.3 + Math.random()*0.6,
        alpha: 0.18 + Math.random()*0.38,
        rot: -0.06 + Math.random()*0.12,
        drot: (-0.006 + Math.random()*0.012),
        wobble: Math.random()*Math.PI*2,
        wobbleSpeed: 0.01 + Math.random()*0.015
      };
    }

    for(let i=0;i<CHAR_COUNT;i++){
      const c = makeChar();
      c.y = Math.random()*H; // start scattered
      chars.push(c);
    }

    function fxLoop(){
      fctx.clearRect(0,0,W,H);
      chars.forEach(c=>{
        c.wobble += c.wobbleSpeed;
        c.x += c.vx + Math.sin(c.wobble)*0.4;
        c.y -= c.vy;
        c.rot += c.drot;

        fctx.save();
        fctx.translate(c.x, c.y);
        fctx.rotate(c.rot);
        fctx.translate(-c.x, -c.y);

        if(c.type === "polly") drawPolly(fctx, c.x, c.y, c.scale, c.alpha);
        else drawPax(fctx, c.x, c.y, c.scale, c.alpha);

        fctx.restore();

        if(c.y < -100 || c.x < -100 || c.x > W+100){
          Object.assign(c, makeChar());
        }
      });
      requestAnimationFrame(fxLoop);
    }
    fxLoop();

    function spawnBurst(n=12){
      for(let i=0;i<n;i++){
        const c = makeChar();
        c.x = W*0.5 + (Math.random()-0.5)*300;
        c.y = H*0.5 + (Math.random()-0.5)*200;
        c.vy = 1.2 + Math.random()*2;
        c.alpha = 0.55 + Math.random()*0.3;
        c.scale = 0.7 + Math.random()*0.8;
        chars.push(c);
      }
      if(chars.length > 60) chars.splice(0, chars.length-60);
    }

    // ---------- Confetti ----------
    const conf = document.getElementById("confetti");
    const cctx = conf.getContext("2d");
    let confetti=[],cW=0,cH=0,cDPR=1;
    function resizeConf(){
      cDPR=devicePixelRatio||1;
      cW=innerWidth; cH=innerHeight;
      conf.width=Math.floor(cW*cDPR);
      conf.height=Math.floor(cH*cDPR);
      cctx.setTransform(cDPR,0,0,cDPR,0,0);
    }
    window.addEventListener("resize",resizeConf);
    resizeConf();

    function blastConfetti(){
      for(let i=0;i<130;i++){
        confetti.push({
          x:cW/2, y:cH/2,
          vx:(Math.random()-0.5)*10,
          vy:(Math.random()-0.9)*10,
          g:0.18+Math.random()*0.18,
          r:Math.random()*Math.PI,
          vr:(Math.random()-0.5)*0.25,
          s:4+Math.random()*5,
          life:120+Math.random()*40,
          hue:20+Math.random()*60 // warm oranges/pinks
        });
      }
      spawnBurst(14);
      confLoop();
    }

    let confRunning=false;
    function confLoop(){
      if(confRunning) return;
      confRunning=true;
      function step(){
        cctx.clearRect(0,0,cW,cH);
        confetti=confetti.filter(p=>p.life>0);
        confetti.forEach(p=>{
          p.life--; p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; p.r+=p.vr;
          cctx.save();
          cctx.translate(p.x,p.y); cctx.rotate(p.r);
          cctx.fillStyle=`hsla(${p.hue},80%,65%,.88)`;
          cctx.fillRect(-p.s/2,-p.s/2,p.s,p.s*.8);
          cctx.restore();
        });
        if(confetti.length){ requestAnimationFrame(step); }
        else{ confRunning=false; cctx.clearRect(0,0,cW,cH); }
      }
      requestAnimationFrame(step);
    }

    // ---------- Idiot Jokes ----------
    const jokes = [
      "Why did the scarecrow win an award? Because he was outstanding in his field. He also forgot where he parked.",
      "I told my dog to sit. He looked at me. I looked at him. Neither of us knew what we were doing.",
      "Why do cows wear bells? Because their horns don't work. They also lost the warranty.",
      "I asked a fish if it wanted to hear a joke. It said no. I told it anyway. It swam away. Fair.",
      "I tried to write a joke about stairs but it was just one step too far. And then I fell.",
      "Why did the tomato turn red? Because it saw the salad dressing. And also it forgot to knock.",
      "My brain has too many tabs open and three of them are just making weird noises.",
      "I put my phone on airplane mode but it still didn't fly. Zero stars.",
      "Why did the bicycle fall over? Because it was two-tired. Also it had no one to call.",
      "I told a joke to my ceiling. It didn't laugh. We're not on speaking terms now.",
      "I tried to catch some fog earlier. I mist. Then I tripped. Then I mist again.",
      "Why don't eggs tell jokes? They'd crack each other up and then there'd be a mess.",
      "I named my dog 'Stay'. Now I can't call him. Well, technically I can, but it backfires.",
      "I'm reading a book about anti-gravity. It's impossible to put down. Also I glued my hands.",
      "Why did the math book look so sad? It had too many problems. Relatable honestly.",
      "I tried to come up with a carpentry joke but none of them were working. Neither was my drill.",
      "A skeleton walked into a bar and ordered a beer and a mop. Nobody asked.",
      "Why can't you give Elsa a balloon? She'll let it go. She'll also deny it immediately.",
      "I used to hate facial hair but then it grew on me. So did the confusion.",
      "What do you call a fish without eyes? A fsh. Also very lost.",
      "I bought some shoes from a drug dealer. I don't know what he laced them with but I was tripping.",
      "Why did the golfer bring an extra pair of pants? In case he got a hole in one. Very prepared.",
      "I'm on a seafood diet. I see food and then I stand there confused about what I want.",
      "What do you call cheese that isn't yours? Nacho cheese. Also a crime technically.",
      "I asked the librarian if they had books about paranoia. She whispered: they're right behind you.",
      "My vacuum broke and it was just collecting dust after that. So were my aspirations.",
      "Why did the can crusher quit? Because the job was soda-pressing. He needed a break.",
      "I have a joke about construction but I'm still working on it. It has been six months.",
      "I told my friend 10 jokes to make him laugh. Sadly no pun in ten did.",
      "What do you call a sleeping dinosaur? A dino-snore. Also don't wake it up.",
    ];

    function getDailyJoke(){
      // Use day of year so it changes daily but stays same all day
      const now = new Date();
      const start = new Date(now.getFullYear(), 0, 0);
      const day = Math.floor((now - start) / 86400000);
      return jokes[day % jokes.length];
    }

    let jokeIndex = jokes.indexOf(getDailyJoke());
    document.getElementById("jokeText").textContent = getDailyJoke();

    document.getElementById("jokeNext").addEventListener("click", ()=>{
      jokeIndex = (jokeIndex + 1) % jokes.length;
      document.getElementById("jokeText").textContent = jokes[jokeIndex];
    });

    // Polyfill for roundRect if needed
    if(!CanvasRenderingContext2D.prototype.roundRect){
      CanvasRenderingContext2D.prototype.roundRect=function(x,y,w,h,r){
        this.beginPath();
        this.moveTo(x+r,y);
        this.lineTo(x+w-r,y);
        this.quadraticCurveTo(x+w,y,x+w,y+r);
        this.lineTo(x+w,y+h-r);
        this.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
        this.lineTo(x+r,y+h);
        this.quadraticCurveTo(x,y+h,x,y+h-r);
        this.lineTo(x,y+r);
        this.quadraticCurveTo(x,y,x+r,y);
        this.closePath();
        return this;
      };
    }
  </script>
</body>
</html>
